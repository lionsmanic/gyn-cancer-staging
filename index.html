<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>å©¦ç™Œè‡¨åºŠåˆ†æœŸè¼”åŠ©ç³»çµ±</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');

:root {
  --teal: #0d7377;
  --teal-light: #14a085;
  --teal-dark: #0a5568;
  --teal-pale: #e4f4f4;
  --accent: #f0a500;
  --bg: #f0f4f7;
  --card: #ffffff;
  --text: #1a2633;
  --text-muted: #5a6a7a;
  --border: #dde3ea;
  --success-bg: #e6f9f2;
  --success-border: #6fcfa8;
  --success-text: #0f6b4a;
  --info-bg: #eaf3ff;
  --info-border: #90b8ef;
  --info-text: #1a4a8a;
  --radius: 14px;
  --radius-sm: 8px;
  --shadow: 0 2px 16px rgba(13,115,119,0.10);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { scroll-behavior: smooth; }

body {
  font-family: 'Noto Sans TC', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  -webkit-text-size-adjust: 100%;
}

/* â”€â”€ HEADER â”€â”€ */
header {
  background: linear-gradient(135deg, var(--teal-dark) 0%, var(--teal) 55%, var(--teal-light) 100%);
  color: #fff;
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 14px;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 2px 12px rgba(10,85,104,0.22);
}
header .logo { font-size: 1.8rem; flex-shrink: 0; }
header h1 { font-size: 1.05rem; font-weight: 700; line-height: 1.3; }
header p { font-size: 0.72rem; opacity: 0.8; margin-top: 2px; font-weight: 300; }

/* â”€â”€ BOTTOM NAV (mobile) â”€â”€ */
.bottom-nav {
  display: none;
  position: fixed;
  bottom: 0; left: 0; right: 0;
  background: #fff;
  border-top: 1px solid var(--border);
  z-index: 200;
  padding: 0 0 env(safe-area-inset-bottom);
}
.bottom-nav-scroll {
  display: flex;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.bottom-nav-scroll::-webkit-scrollbar { display: none; }
.bottom-nav-scroll button {
  flex-shrink: 0;
  background: none;
  border: none;
  padding: 8px 14px;
  font-size: 0.7rem;
  font-family: inherit;
  color: var(--text-muted);
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  border-top: 2.5px solid transparent;
  transition: all 0.15s;
  white-space: nowrap;
}
.bottom-nav-scroll button .nav-icon { font-size: 1.1rem; }
.bottom-nav-scroll button.active {
  color: var(--teal);
  border-top-color: var(--teal);
  font-weight: 600;
}

/* â”€â”€ DESKTOP SIDEBAR â”€â”€ */
.layout { display: flex; }
aside {
  width: 210px;
  background: #fff;
  border-right: 1px solid var(--border);
  padding: 18px 0;
  flex-shrink: 0;
  position: sticky;
  top: 62px;
  height: calc(100vh - 62px);
  overflow-y: auto;
}
aside .nav-label {
  font-size: 0.68rem;
  font-weight: 700;
  letter-spacing: 1.5px;
  color: var(--text-muted);
  padding: 10px 18px 4px;
  text-transform: uppercase;
}
aside button {
  display: block;
  width: 100%;
  background: none;
  border: none;
  text-align: left;
  padding: 9px 18px;
  cursor: pointer;
  font-size: 0.84rem;
  color: var(--text-muted);
  font-family: inherit;
  border-left: 3px solid transparent;
  transition: all 0.15s;
  line-height: 1.4;
}
aside button:hover { background: #f0f8f8; color: var(--teal); }
aside button.active {
  background: #e6f5f5;
  color: var(--teal-dark);
  font-weight: 600;
  border-left-color: var(--teal);
}
aside .nav-divider { height: 1px; background: var(--border); margin: 8px 14px; }

/* â”€â”€ MAIN â”€â”€ */
main {
  flex: 1;
  padding: 24px 28px;
  overflow-x: hidden;
  min-width: 0;
}

/* â”€â”€ PAGES â”€â”€ */
.page { display: none; }
.page.active { display: block; animation: fadeIn 0.25s ease; }
@keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

.page-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--teal-dark);
  margin-bottom: 4px;
}
.page-sub {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin-bottom: 20px;
}

/* â”€â”€ CARD â”€â”€ */
.card {
  background: var(--card);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 18px 20px;
  margin-bottom: 14px;
  box-shadow: var(--shadow);
}
.card-title {
  font-size: 0.86rem;
  font-weight: 700;
  color: var(--teal);
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  gap: 7px;
}

/* â”€â”€ GRID â”€â”€ */
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

/* â”€â”€ FORM â”€â”€ */
.form-group { margin-bottom: 12px; }
.field-label {
  display: block;
  font-size: 0.78rem;
  font-weight: 600;
  color: var(--text-muted);
  margin-bottom: 6px;
  letter-spacing: 0.2px;
}
select, input[type="password"] {
  width: 100%;
  padding: 10px 12px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  font-size: 0.88rem;
  font-family: inherit;
  background: #f8fafc;
  color: var(--text);
  transition: border 0.15s;
  outline: none;
  -webkit-appearance: none;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%235a6a7a' d='M6 8L0 0h12z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 32px;
}
select:focus, input:focus { border-color: var(--teal); background: #fff; }

/* â”€â”€ RADIO / CHECKBOX â”€â”€ */
.radio-group, .check-group { display: flex; flex-direction: column; gap: 8px; }
.radio-item, .check-item {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  cursor: pointer;
  font-size: 0.85rem;
  line-height: 1.5;
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  border: 1.5px solid var(--border);
  background: #f8fafc;
  transition: all 0.15s;
}
.radio-item:has(input:checked), .check-item:has(input:checked) {
  background: var(--teal-pale);
  border-color: var(--teal);
}
.radio-item input, .check-item input {
  margin-top: 3px;
  flex-shrink: 0;
  accent-color: var(--teal);
  width: 16px; height: 16px;
  cursor: pointer;
}

/* â”€â”€ BUTTON â”€â”€ */
.btn {
  background: var(--teal);
  color: #fff;
  border: none;
  border-radius: var(--radius-sm);
  padding: 14px 24px;
  font-size: 0.95rem;
  font-weight: 700;
  cursor: pointer;
  font-family: inherit;
  transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  letter-spacing: 0.3px;
  box-shadow: 0 4px 14px rgba(13,115,119,0.28);
}
.btn:hover { background: var(--teal-dark); transform: translateY(-1px); box-shadow: 0 6px 18px rgba(13,115,119,0.32); }
.btn:active { transform: translateY(1px); box-shadow: 0 2px 8px rgba(13,115,119,0.2); }

/* â”€â”€ RESULT â”€â”€ */
.result-wrap { margin-top: 16px; }
.result-box {
  border-radius: var(--radius-sm);
  padding: 16px 18px;
  margin-bottom: 8px;
  font-weight: 600;
  font-size: 1rem;
  display: none;
  animation: fadeIn 0.3s ease;
}
.result-box.show { display: block; }
.result-success { background: var(--success-bg); border: 1.5px solid var(--success-border); color: var(--success-text); }
.result-info { background: var(--info-bg); border: 1.5px solid var(--info-border); color: var(--info-text); font-size: 0.88rem; font-weight: 400; }
.result-warning { background: #fff8e1; border: 1.5px solid #f0c040; color: #7a5a00; font-size: 0.9rem; }

/* â”€â”€ AI PAGE â”€â”€ */
.api-warn {
  background: #fff3cd;
  border: 1.5px solid #f0c040;
  border-radius: var(--radius-sm);
  padding: 12px 15px;
  font-size: 0.82rem;
  color: #7a5a00;
  margin-bottom: 14px;
  line-height: 1.5;
}
.upload-area {
  border: 2px dashed var(--teal);
  border-radius: var(--radius);
  background: #f0f9f9;
  padding: 32px 20px;
  text-align: center;
  cursor: pointer;
  transition: background 0.15s;
  position: relative;
  touch-action: manipulation;
}
.upload-area:active { background: #d8f0f0; }
.upload-area input[type="file"] {
  position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
}
.upload-area .upload-icon { font-size: 2.4rem; margin-bottom: 10px; }
.upload-area p { color: var(--text-muted); font-size: 0.86rem; }

.preview-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
  gap: 10px;
  margin-top: 14px;
}
.preview-item {
  position: relative;
  aspect-ratio: 1;
  border-radius: 8px;
  overflow: hidden;
  border: 2px solid var(--border);
}
.preview-item img { width: 100%; height: 100%; object-fit: cover; }
.preview-item .rm-btn {
  position: absolute; top: 4px; right: 4px;
  background: rgba(0,0,0,0.6);
  color: #fff; border: none; border-radius: 50%;
  width: 22px; height: 22px; font-size: 0.72rem;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
}

.spinner {
  display: none; text-align: center; padding: 28px 0; color: var(--teal); font-size: 0.88rem;
}
.spinner.show { display: block; }
.spin-circle {
  width: 40px; height: 40px;
  border: 3px solid #c0e0e0; border-top-color: var(--teal);
  border-radius: 50%; margin: 0 auto 14px;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.ai-result-box {
  background: #fff; border: 1.5px solid var(--border);
  border-radius: var(--radius); padding: 18px 20px;
  margin-top: 16px; display: none; line-height: 1.75;
}
.ai-result-box.show { display: block; animation: fadeIn 0.3s ease; }
.ai-result-box h2 { color: var(--teal-dark); font-size: 0.95rem; margin-bottom: 12px; }
.ai-result-box h3 { color: var(--teal); font-size: 0.9rem; margin: 14px 0 6px; }
.ai-result-box h4 { color: var(--teal-dark); font-size: 0.87rem; margin: 12px 0 5px; }
.ai-result-box p { font-size: 0.86rem; margin-bottom: 7px; }
.ai-result-box ul { padding-left: 18px; margin: 6px 0; }
.ai-result-box li { font-size: 0.85rem; margin-bottom: 3px; }
.ai-result-box table { border-collapse: collapse; width: 100%; margin: 10px 0; font-size: 0.82rem; overflow-x: auto; display: block; }
.ai-result-box th { background: #e8f5f5; color: var(--teal-dark); padding: 7px 10px; text-align: left; border: 1px solid var(--border); white-space: nowrap; }
.ai-result-box td { padding: 6px 10px; border: 1px solid var(--border); }
.ai-result-box tr:nth-child(even) td { background: #f8fafc; }
.ai-result-box strong { color: var(--teal-dark); }

/* â”€â”€ RESPONSIVE â”€â”€ */
@media (max-width: 768px) {
  aside { display: none; }
  .bottom-nav { display: block; }
  main {
    padding: 16px 14px;
    padding-bottom: calc(64px + env(safe-area-inset-bottom));
  }
  .two-col { grid-template-columns: 1fr; }
  .page-title { font-size: 1.1rem; }
  .btn { padding: 15px; font-size: 0.92rem; }
}
@media (min-width: 769px) {
  header p { display: block; }
}
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">âš•ï¸</div>
  <div>
    <h1>å©¦ç™Œè‡¨åºŠåˆ†æœŸè¼”åŠ©ç³»çµ±</h1>
    <p>Gynecologic Oncology Staging Â· FIGO &amp; AJCC TNM</p>
  </div>
</header>

<!-- DESKTOP SIDEBAR -->
<div class="layout">
<aside>
  <div class="nav-label">åˆ†æœŸåˆ¤å®š</div>
  <button class="active" onclick="showPage('endometrial',this)">ğŸ“‹ å­å®®å…§è†œç™Œ</button>
  <button onclick="showPage('ovarian',this)">ğŸ”µ åµå·¢ç™Œ</button>
  <button onclick="showPage('cervical',this)">ğŸ”´ å­å®®é ¸ç™Œ</button>
  <button onclick="showPage('sarcoma',this)">ğŸŸ  å­å®®æƒ¡æ€§è‚‰ç˜¤</button>
  <button onclick="showPage('melanoma',this)">âš« å¤–é™°é»‘è‰²ç´ ç˜¤</button>
  <button onclick="showPage('vaginal',this)">ğŸŸ£ é™°é“ç™Œ</button>
  <button onclick="showPage('gtn',this)">ğŸŸ¡ GTN</button>
  <button onclick="showPage('vulvar',this)">ğŸŸ¤ å¤–é™°ç™Œ</button>
  <div class="nav-divider"></div>
  <div class="nav-label">AI è¼”åŠ©</div>
  <button onclick="showPage('ai',this)">ğŸ¤– AI æ™ºæ…§åˆ¤è®€</button>
</aside>

<!-- MAIN -->
<main>

  <!-- ===== å­å®®å…§è†œç™Œ ===== -->
  <div class="page active" id="page-endometrial">
    <div class="page-title">å­å®®å…§è†œç™Œåˆ†æœŸ</div>
    <div class="page-sub">Endometrial Cancer Â· FIGO 2023</div>
    <div class="card">
      <div class="card-title">ğŸ”¬ çµ„ç¹”å­¸å‹æ…‹</div>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="ec_histo" value="nonaggressive" checked> éå…‡éšª â€“ Low grade G1/G2 endometrioid</label>
        <label class="radio-item"><input type="radio" name="ec_histo" value="aggressive"> å…‡éšª â€“ Serous, Clear cell, Undifferentiated, Carcinosarcoma, G3</label>
      </div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ©º å­å®®è‚Œå±¤ä¾µçŠ¯æ·±åº¦</div>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="ec_myo" value="none" checked> ç„¡ä¾µçŠ¯</label>
        <label class="radio-item"><input type="radio" name="ec_myo" value="lt50"> &lt;50%</label>
        <label class="radio-item"><input type="radio" name="ec_myo" value="ge50"> â‰¥50%</label>
      </div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ©¸ LVSI è¡€ç®¡/æ·‹å·´ç®¡ä¾µçŠ¯</div>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="ec_lvsi" value="none" checked> ç„¡ä¾µçŠ¯</label>
        <label class="radio-item"><input type="radio" name="ec_lvsi" value="focal"> è¼•å¾®ä¾µçŠ¯ (focal)</label>
        <label class="radio-item"><input type="radio" name="ec_lvsi" value="extensive"> å¤§é‡ä¾µçŠ¯ (extensive â‰¥5 vessels)</label>
      </div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”µ æ·‹å·´çµè½‰ç§»å¤§å°</div>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="ec_ln" value="none" checked> ç„¡è½‰ç§»</label>
        <label class="radio-item"><input type="radio" name="ec_ln" value="micro"> å¾®è½‰ç§» (0.2â€“2 mm)</label>
        <label class="radio-item"><input type="radio" name="ec_ln" value="macro"> å·¨è½‰ç§» (&gt;2 mm)</label>
      </div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ“ ä¾µçŠ¯ç¯„åœï¼ˆå¯è¤‡é¸ï¼‰</div>
      <div class="check-group">
        <label class="check-item"><input type="checkbox" id="ec_cervical"> å®®é ¸é–“è³ªä¾µçŠ¯</label>
        <label class="check-item"><input type="checkbox" id="ec_ovarian_tubal"> åµå·¢æˆ–è¼¸åµç®¡ä¾µçŠ¯</label>
        <label class="check-item"><input type="checkbox" id="ec_ovarian_limited"> åµå·¢è…«ç˜¤å–®å´ä¾·é™ç„¡ç ´è£‚</label>
        <label class="check-item"><input type="checkbox" id="ec_serosa"> æ¼¿è†œä¾µçŠ¯</label>
        <label class="check-item"><input type="checkbox" id="ec_vaginal"> é™°é“æˆ–å­å®®æ—ä¾µçŠ¯</label>
        <label class="check-item"><input type="checkbox" id="ec_pelvic_peri"> éª¨ç›†è…¹è†œä¾µçŠ¯</label>
        <label class="check-item"><input type="checkbox" id="ec_upper_abd"> éª¨ç›†ä»¥ä¸Šè…¹è…”è…¹è†œä¾µçŠ¯</label>
        <label class="check-item"><input type="checkbox" id="ec_bladder"> è†€èƒ±æˆ–è…¸é»è†œä¾µçŠ¯</label>
        <label class="check-item"><input type="checkbox" id="ec_distant"> é è™•è½‰ç§»ï¼ˆè…¹è…”å¤–æ·‹å·´çµ/è‚º/è‚/è…¦/éª¨ï¼‰</label>
      </div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ§¬ æ·‹å·´çµ &amp; åˆ†å­ç‰¹å¾µ</div>
      <div class="check-group">
        <label class="check-item"><input type="checkbox" id="ec_pelvic_ln"> éª¨ç›†æ·‹å·´çµè½‰ç§»</label>
        <label class="check-item"><input type="checkbox" id="ec_pa_ln"> ä¸»å‹•è„ˆæ—æ·‹å·´çµè½‰ç§»</label>
        <label class="check-item"><input type="checkbox" id="ec_pole"> POLE mutation</label>
        <label class="check-item"><input type="checkbox" id="ec_p53"> p53 abnormal</label>
      </div>
    </div>
    <button class="btn" onclick="stageEndometrial()">âš¡ è¨ˆç®—åˆ†æœŸ</button>
    <div class="result-wrap">
      <div class="result-box result-success" id="ec_result"></div>
      <div class="result-box result-info" id="ec_tnm"></div>
    </div>
  </div>

  <!-- ===== åµå·¢ç™Œ ===== -->
  <div class="page" id="page-ovarian">
    <div class="page-title">åµå·¢ç™Œåˆ†æœŸ</div>
    <div class="page-sub">Ovarian Cancer Â· FIGO 2014</div>
    <div class="card">
      <div class="card-title">ğŸ”· T â€“ åŸç™¼è…«ç˜¤</div>
      <select id="ov_t">
        <option value="T1a">T1a â€“ å–®å´åµå·¢/è¼¸åµç®¡ï¼Œæœªç ´è£‚</option>
        <option value="T1b">T1b â€“ é›™å´åµå·¢/è¼¸åµç®¡ï¼Œæœªç ´è£‚</option>
        <option value="T1c1">T1c1 â€“ æ‰‹è¡“æ™‚è…«ç˜¤æº¢å‡º</option>
        <option value="T1c2">T1c2 â€“ è¡“å‰ç ´è£‚æˆ–è…«ç˜¤è¡¨é¢</option>
        <option value="T1c3">T1c3 â€“ è…¹æ°´/è…¹è†œæ²–æ´—ç´°èƒå­¸é™½æ€§</option>
        <option value="T2a">T2a â€“ å­å®®æˆ–è¼¸åµç®¡è½‰ç§»</option>
        <option value="T2b">T2b â€“ å…¶ä»–éª¨ç›†çµ„ç¹”è½‰ç§»</option>
        <option value="T3a">T3a â€“ è…¹è…”é¡¯å¾®è½‰ç§»</option>
        <option value="T3b">T3b â€“ è…¹è…”è½‰ç§» â‰¤2 cm</option>
        <option value="T3c">T3c â€“ è…¹è…”è½‰ç§» &gt;2 cm</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· N â€“ æ·‹å·´çµ</div>
      <select id="ov_n">
        <option value="N0">N0 â€“ ç„¡æ·‹å·´çµè½‰ç§»</option>
        <option value="N1a">N1a â€“ è…¹è†œå¾Œè½‰ç§» â‰¤10 mm</option>
        <option value="N1b">N1b â€“ è…¹è†œå¾Œè½‰ç§» &gt;10 mm</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· M â€“ é ç«¯è½‰ç§»</div>
      <select id="ov_m">
        <option value="M0">M0 â€“ ç„¡é ç«¯è½‰ç§»</option>
        <option value="M1a">M1a â€“ èƒ¸æ°´ç´°èƒå­¸é™½æ€§</option>
        <option value="M1b">M1b â€“ è‚è„¾å¯¦è³ªæˆ–è…¹å¤–å™¨å®˜è½‰ç§»</option>
      </select>
    </div>
    <button class="btn" onclick="stageOvarian()">âš¡ è¨ˆç®—åˆ†æœŸ</button>
    <div class="result-wrap">
      <div class="result-box result-success" id="ov_result"></div>
      <div class="result-box result-info" id="ov_tnm"></div>
    </div>
  </div>

  <!-- ===== å­å®®é ¸ç™Œ ===== -->
  <div class="page" id="page-cervical">
    <div class="page-title">å­å®®é ¸ç™Œåˆ†æœŸ</div>
    <div class="page-sub">Cervical Cancer Â· FIGO 2018</div>
    <div class="card">
      <div class="card-title">ğŸ”· T Stage</div>
      <select id="cx_t">
        <option value="T1a1">T1a1 â€“ Stromal invasion &lt;3 mm</option>
        <option value="T1a2">T1a2 â€“ Stromal invasion 3â€“5 mm</option>
        <option value="T1b1">T1b1 â€“ Invasion â‰¥5 mm, &lt;2 cm</option>
        <option value="T1b2">T1b2 â€“ Dimension 2â€“4 cm</option>
        <option value="T1b3">T1b3 â€“ Dimension â‰¥4 cm</option>
        <option value="T2a1">T2a1 â€“ Vaginal involvement &lt;4 cm</option>
        <option value="T2a2">T2a2 â€“ Vaginal involvement â‰¥4 cm</option>
        <option value="T2b">T2b â€“ Parametrial invasion</option>
        <option value="T3a">T3a â€“ Lower third vagina</option>
        <option value="T3b">T3b â€“ Pelvic wall / hydronephrosis</option>
        <option value="T3c1">T3c1 â€“ Pelvic LN metastasis</option>
        <option value="T3c2">T3c2 â€“ Paraaortic LN metastasis</option>
        <option value="T4">T4 â€“ Bladder/rectum mucosal or beyond pelvis</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· N Stage</div>
      <select id="cx_n">
        <option value="N0">N0 â€“ No regional LN metastasis</option>
        <option value="N0i">N0(i+) â€“ Isolated tumor cells â‰¤0.2 mm</option>
        <option value="N1">N1 â€“ Regional LN metastasis</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· M Stage</div>
      <select id="cx_m">
        <option value="M0">M0 â€“ No distant metastasis</option>
        <option value="M1">M1 â€“ Distant metastasis</option>
      </select>
    </div>
    <button class="btn" onclick="stageCervical()">âš¡ è¨ˆç®—åˆ†æœŸ</button>
    <div class="result-wrap">
      <div class="result-box result-success" id="cx_result"></div>
      <div class="result-box result-info" id="cx_tnm"></div>
    </div>
  </div>

  <!-- ===== å­å®®æƒ¡æ€§è‚‰ç˜¤ ===== -->
  <div class="page" id="page-sarcoma">
    <div class="page-title">å­å®®æƒ¡æ€§è‚‰ç˜¤åˆ†æœŸ</div>
    <div class="page-sub">Uterine Sarcoma Â· FIGO &amp; AJCC TNM</div>
    <div class="card">
      <div class="card-title">ğŸ”¬ Sarcoma Type</div>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="sarc_type" value="LMS" checked onchange="updateSarcomaT()"> Leiomyosarcoma</label>
        <label class="radio-item"><input type="radio" name="sarc_type" value="ESS" onchange="updateSarcomaT()"> Endometrial Stromal Sarcoma</label>
        <label class="radio-item"><input type="radio" name="sarc_type" value="MAS" onchange="updateSarcomaT()"> MÃ¼llerian Adenosarcoma</label>
      </div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· T Stage</div>
      <select id="sarc_t"></select>
    </div>
    <div class="two-col">
      <div class="card">
        <div class="card-title">ğŸ”· N Stage</div>
        <select id="sarc_n">
          <option value="N0">N0 â€“ No regional LN metastasis</option>
          <option value="N1">N1 â€“ Regional LN metastasis</option>
        </select>
      </div>
      <div class="card">
        <div class="card-title">ğŸ”· M Stage</div>
        <select id="sarc_m">
          <option value="M0">M0 â€“ No distant metastasis</option>
          <option value="M1">M1 â€“ Distant metastasis</option>
        </select>
      </div>
    </div>
    <button class="btn" onclick="stageSarcoma()">âš¡ è¨ˆç®—åˆ†æœŸ</button>
    <div class="result-wrap">
      <div class="result-box result-success" id="sarc_result"></div>
      <div class="result-box result-info" id="sarc_tnm"></div>
    </div>
  </div>

  <!-- ===== å¤–é™°é»‘è‰²ç´ ç˜¤ ===== -->
  <div class="page" id="page-melanoma">
    <div class="page-title">å¤–é™°é»‘è‰²ç´ ç˜¤åˆ†æœŸ</div>
    <div class="page-sub">Vulvar Melanoma Â· AJCC 8th Edition</div>
    <div class="card">
      <div class="card-title">ğŸ”· T åˆ†é¡</div>
      <select id="mel_t">
        <option value="Tis">Tis â€“ åŸä½ç™Œ</option>
        <option value="T1a">T1a â€“ &lt;0.8mmï¼Œç„¡æ½°ç˜</option>
        <option value="T1b">T1b â€“ &lt;0.8mmæœ‰æ½°ç˜ï¼Œæˆ–0.8â€“1.0mm</option>
        <option value="T2a">T2a â€“ 1.0â€“2.0mmï¼Œç„¡æ½°ç˜</option>
        <option value="T2b">T2b â€“ 1.0â€“2.0mmï¼Œæœ‰æ½°ç˜</option>
        <option value="T3a">T3a â€“ 2.0â€“4.0mmï¼Œç„¡æ½°ç˜</option>
        <option value="T3b">T3b â€“ 2.0â€“4.0mmï¼Œæœ‰æ½°ç˜</option>
        <option value="T4a">T4a â€“ &gt;4.0mmï¼Œç„¡æ½°ç˜</option>
        <option value="T4b">T4b â€“ &gt;4.0mmï¼Œæœ‰æ½°ç˜</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· N åˆ†é¡</div>
      <select id="mel_n">
        <option value="N0">N0 â€“ ç„¡å€åŸŸæ·‹å·´çµè½‰ç§»</option>
        <option value="N1a">N1a â€“ å–®ä¸€éš±åŒ¿æ€§è½‰ç§»æ·‹å·´çµ</option>
        <option value="N1b">N1b â€“ å–®ä¸€è‡¨åºŠåµæ¸¬æ·‹å·´çµ</option>
        <option value="N1c">N1c â€“ ç„¡æ·‹å·´çµä½†æœ‰è¡›æ˜Ÿ/å¾®è¡›æ˜Ÿè½‰ç§»</option>
        <option value="N2a">N2a â€“ 2â€“3å€‹éš±åŒ¿æ€§è½‰ç§»æ·‹å·´çµ</option>
        <option value="N2b">N2b â€“ 2â€“3å€‹ä¸­è‡³å°‘ä¸€å€‹è‡¨åºŠåµæ¸¬</option>
        <option value="N2c">N2c â€“ ä¸€å€‹è‡¨åºŠ/éš±åŒ¿æ€§æ·‹å·´çµä¸”æœ‰è¡›æ˜Ÿè½‰ç§»</option>
        <option value="N3a">N3a â€“ â‰¥4å€‹éš±åŒ¿æ€§è½‰ç§»æ·‹å·´çµ</option>
        <option value="N3b">N3b â€“ â‰¥4å€‹ä¸­è‡³å°‘ä¸€å€‹è‡¨åºŠåµæ¸¬</option>
        <option value="N3c">N3c â€“ â‰¥2å€‹è‡¨åºŠ/éš±åŒ¿æ€§æ·‹å·´çµæˆ–èåˆæ·‹å·´çµ</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· M åˆ†é¡</div>
      <select id="mel_m">
        <option value="M0">M0 â€“ ç„¡é è™•è½‰ç§»</option>
        <option value="M1a0">M1a(0) â€“ çš®è†š/è»Ÿçµ„ç¹”/éå€åŸŸæ·‹å·´çµï¼ŒLDHæ­£å¸¸</option>
        <option value="M1a1">M1a(1) â€“ çš®è†š/è»Ÿçµ„ç¹”/éå€åŸŸæ·‹å·´çµï¼ŒLDHå‡é«˜</option>
        <option value="M1b0">M1b(0) â€“ è‚ºè½‰ç§»ï¼ŒLDHæ­£å¸¸</option>
        <option value="M1b1">M1b(1) â€“ è‚ºè½‰ç§»ï¼ŒLDHå‡é«˜</option>
        <option value="M1c0">M1c(0) â€“ éä¸­æ¨å…§è‡Ÿè½‰ç§»ï¼ŒLDHæ­£å¸¸</option>
        <option value="M1c1">M1c(1) â€“ éä¸­æ¨å…§è‡Ÿè½‰ç§»ï¼ŒLDHå‡é«˜</option>
        <option value="M1d0">M1d(0) â€“ ä¸­æ¨ç¥ç¶“è½‰ç§»ï¼ŒLDHæ­£å¸¸</option>
        <option value="M1d1">M1d(1) â€“ ä¸­æ¨ç¥ç¶“è½‰ç§»ï¼ŒLDHå‡é«˜</option>
      </select>
    </div>
    <button class="btn" onclick="stageMelanoma()">âš¡ è¨ˆç®—åˆ†æœŸ</button>
    <div class="result-wrap">
      <div class="result-box result-success" id="mel_result"></div>
      <div class="result-box result-info" id="mel_tnm"></div>
    </div>
  </div>

  <!-- ===== é™°é“ç™Œ ===== -->
  <div class="page" id="page-vaginal">
    <div class="page-title">é™°é“ç™Œåˆ†æœŸ</div>
    <div class="page-sub">Vaginal Cancer Â· FIGO &amp; AJCC TNM</div>
    <div class="card">
      <div class="card-title">ğŸ”· T â€“ è…«ç˜¤å¤§å°èˆ‡ä¾µçŠ¯</div>
      <select id="vag_t">
        <option value="T1a">T1a â€“ ä¾·é™æ–¼é™°é“ï¼Œâ‰¤2.0 cm</option>
        <option value="T1b">T1b â€“ ä¾·é™æ–¼é™°é“ï¼Œ&gt;2.0 cm</option>
        <option value="T2a">T2a â€“ ç©¿é€é™°é“å£ï¼Œâ‰¤2.0 cm</option>
        <option value="T2b">T2b â€“ ç©¿é€é™°é“å£ï¼Œ&gt;2.0 cm</option>
        <option value="T3">T3 â€“ é”éª¨ç›†å£æˆ–è…ç©æ°´</option>
        <option value="T4">T4 â€“ ä¾µçŠ¯è†€èƒ±/ç›´è…¸æˆ–è¶…å‡ºéª¨ç›†</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· N â€“ æ·‹å·´çµ</div>
      <select id="vag_n">
        <option value="N0">N0 â€“ ç„¡å€åŸŸæ·‹å·´çµè½‰ç§»</option>
        <option value="N1">N1 â€“ éª¨ç›†æˆ–é¼ è¹Šæ·‹å·´çµè½‰ç§»</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· M â€“ é è™•è½‰ç§»</div>
      <select id="vag_m">
        <option value="M0">M0 â€“ ç„¡é è™•è½‰ç§»</option>
        <option value="M1">M1 â€“ æœ‰é è™•è½‰ç§»</option>
      </select>
    </div>
    <button class="btn" onclick="stageVaginal()">âš¡ è¨ˆç®—åˆ†æœŸ</button>
    <div class="result-wrap">
      <div class="result-box result-success" id="vag_result"></div>
      <div class="result-box result-info" id="vag_tnm"></div>
    </div>
  </div>

  <!-- ===== GTN ===== -->
  <div class="page" id="page-gtn">
    <div class="page-title">å¦Šå¨ æ»‹é¤Šå±¤ç´°èƒè…«ç˜¤</div>
    <div class="page-sub">GTN Â· FIGO &amp; WHO Risk Score</div>
    <div class="card">
      <div class="card-title">ğŸ”· T åˆ†é¡</div>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="gtn_t" value="T1" checked> T1 â€“ è…«ç˜¤ä¾·é™æ–¼å­å®®</label>
        <label class="radio-item"><input type="radio" name="gtn_t" value="T2"> T2 â€“ è…«ç˜¤å»¶ä¼¸è‡³å…¶ä»–ç”Ÿæ®–å™¨å®˜</label>
      </div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· M åˆ†é¡</div>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="gtn_m" value="M0" checked> M0 â€“ ç„¡é è™•è½‰ç§»</label>
        <label class="radio-item"><input type="radio" name="gtn_m" value="M1a"> M1a â€“ è‚ºè½‰ç§»</label>
        <label class="radio-item"><input type="radio" name="gtn_m" value="M1b"> M1b â€“ å…¶ä»–é è™•è½‰ç§»</label>
      </div>
    </div>
    <div class="card">
      <div class="card-title">âš ï¸ WHO é¢¨éšªè©•åˆ†</div>
      <div class="form-group">
        <label class="field-label">å¹´é½¡</label>
        <select id="gtn_age"><option value="0">0 â€“ &lt;40 æ­²</option><option value="1">1 â€“ â‰¥40 æ­²</option></select>
      </div>
      <div class="form-group">
        <label class="field-label">å‰æ¬¡æ‡·å­•</label>
        <select id="gtn_preg"><option value="0">0 â€“ è‘¡è„èƒ</option><option value="1">1 â€“ æµç”¢</option><option value="2">2 â€“ è¶³æœˆå¦Šå¨ </option></select>
      </div>
      <div class="form-group">
        <label class="field-label">è·å‰æ¬¡å¦Šå¨ æ™‚é–“</label>
        <select id="gtn_interval"><option value="0">0 â€“ &lt;4 å€‹æœˆ</option><option value="1">1 â€“ 4â€“6 å€‹æœˆ</option><option value="2">2 â€“ 7â€“12 å€‹æœˆ</option><option value="4">4 â€“ &gt;12 å€‹æœˆ</option></select>
      </div>
      <div class="form-group">
        <label class="field-label">æ²»ç™‚å‰ hCG (IU/mL)</label>
        <select id="gtn_hcg"><option value="0">0 â€“ &lt;10Â³</option><option value="1">1 â€“ 10Â³â€“10â´</option><option value="2">2 â€“ 10â´â€“10âµ</option><option value="4">4 â€“ â‰¥10âµ</option></select>
      </div>
      <div class="form-group">
        <label class="field-label">è…«ç˜¤æœ€å¤§ç›´å¾‘</label>
        <select id="gtn_size"><option value="0">0 â€“ &lt;3 cm</option><option value="1">1 â€“ 3â€“5 cm</option><option value="2">2 â€“ &gt;5 cm</option></select>
      </div>
      <div class="form-group">
        <label class="field-label">è½‰ç§»ä½ç½®</label>
        <select id="gtn_site"><option value="0">0 â€“ ç„¡æˆ–åƒ…è‚º</option><option value="1">1 â€“ è„¾è‡Ÿ/è…è‡Ÿ</option><option value="2">2 â€“ è…¸èƒƒé“</option><option value="4">4 â€“ è…¦/è‚è‡Ÿ</option></select>
      </div>
      <div class="form-group">
        <label class="field-label">è½‰ç§»ç—…ç¶æ•¸é‡</label>
        <select id="gtn_num"><option value="0">0 â€“ ç„¡</option><option value="1">1 â€“ 1â€“4 è™•</option><option value="2">2 â€“ 5â€“8 è™•</option><option value="4">4 â€“ &gt;8 è™•</option></select>
      </div>
      <div class="form-group">
        <label class="field-label">åŒ–ç™‚å¤±æ•—æ¬¡æ•¸</label>
        <select id="gtn_chemo"><option value="0">0 â€“ ç„¡</option><option value="2">2 â€“ å–®ä¸€è—¥ç‰©</option><option value="4">4 â€“ å…©ç¨®ä»¥ä¸Šè—¥ç‰©</option></select>
      </div>
    </div>
    <button class="btn" onclick="stageGTN()">âš¡ è¨ˆç®—åˆ†æœŸèˆ‡é¢¨éšª</button>
    <div class="result-wrap">
      <div class="result-box result-success" id="gtn_result"></div>
      <div class="result-box result-warning" id="gtn_score"></div>
    </div>
  </div>

  <!-- ===== å¤–é™°ç™Œ ===== -->
  <div class="page" id="page-vulvar">
    <div class="page-title">å¤–é™°ç™Œåˆ†æœŸ</div>
    <div class="page-sub">Vulvar Cancer Â· FIGO 2021</div>
    <div class="card">
      <div class="card-title">ğŸ”· T åˆ†æœŸ</div>
      <select id="vul_t">
        <option value="Tis">Tis â€“ åŸä½ç™Œ</option>
        <option value="T1a">T1a â€“ ç—…ç¶ â‰¤2 cmï¼Œæµ¸æ½¤æ·±åº¦ â‰¤1.0 mm</option>
        <option value="T1b">T1b â€“ ç—…ç¶ &gt;2 cm æˆ–æµ¸æ½¤æ·±åº¦ &gt;1.0 mm</option>
        <option value="T2">T2 â€“ å»¶ä¼¸è‡³ä¸‹1/3å°¿é“ã€ä¸‹1/3é™°é“æˆ–è‚›é–€</option>
        <option value="T3">T3 â€“ ä¾µçŠ¯ä¸Š2/3å°¿é“ã€ä¸Š2/3é™°é“ã€è†€èƒ±/ç›´è…¸é»è†œæˆ–éª¨ç›†éª¨</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· N åˆ†æœŸ</div>
      <select id="vul_n">
        <option value="N0">N0 â€“ ç„¡å€åŸŸæ·‹å·´çµè½‰ç§»</option>
        <option value="N1a">N1a â€“ 1â€“2å€‹æ·‹å·´çµï¼Œå„ &lt;5 mm</option>
        <option value="N1b">N1b â€“ 1å€‹æ·‹å·´çµ â‰¥5 mm</option>
        <option value="N2a">N2a â€“ â‰¥3å€‹æ·‹å·´çµï¼Œå„ &lt;5 mm</option>
        <option value="N2b">N2b â€“ â‰¥2å€‹æ·‹å·´çµ â‰¥5 mm</option>
        <option value="N2c">N2c â€“ æ·‹å·´çµè½‰ç§»ä¼´å¤–å›Šä¾µçŠ¯</option>
        <option value="N3">N3 â€“ å›ºå®šæˆ–æ½°ç˜æ€§æ·‹å·´çµè½‰ç§»</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”· M åˆ†æœŸ</div>
      <select id="vul_m">
        <option value="M0">M0 â€“ ç„¡é è™•è½‰ç§»</option>
        <option value="M1">M1 â€“ æœ‰é è™•è½‰ç§»ï¼ˆå«éª¨ç›†æ·‹å·´çµï¼‰</option>
      </select>
    </div>
    <button class="btn" onclick="stageVulvar()">âš¡ è¨ˆç®—åˆ†æœŸ</button>
    <div class="result-wrap">
      <div class="result-box result-success" id="vul_result"></div>
      <div class="result-box result-info" id="vul_tnm"></div>
    </div>
  </div>

  <!-- ===== AI ===== -->
  <div class="page" id="page-ai">
    <div class="page-title">ğŸ¤– AI æ™ºæ…§åˆ¤è®€</div>
    <div class="page-sub">ä¸Šå‚³ç—…ç†/å½±åƒå ±å‘Šï¼Œç”± Gemini AI è§£è®€ä¸¦åˆ¤å®šåˆ†æœŸ</div>
    <div class="api-warn">
      âš ï¸ <strong>éš±ç§è­¦å‘Šï¼š</strong>è«‹å‹¿ä¸Šå‚³å«æœ‰çœŸå¯¦ç—…æ‚£å§“åã€èº«åˆ†è­‰è™Ÿç¢¼ç­‰å€‹è³‡çš„åœ–ç‰‡ã€‚æœ¬åŠŸèƒ½åƒ…ä¾›è‡¨åºŠè¼”åŠ©ï¼Œæœ€çµ‚åˆ†æœŸé ˆç”±é†«å¸«ç¢ºèªã€‚
    </div>
    <div class="card">
      <div class="card-title">ğŸ”‘ Gemini API Key</div>
      <input type="password" id="ai_apikey" placeholder="è«‹è¼¸å…¥ Google Gemini API Key...">
    </div>
    <div class="card">
      <div class="card-title">ğŸ©º ç™Œç—‡é¡å‹ä¸Šä¸‹æ–‡</div>
      <select id="ai_context">
        <option>å­å®®å…§è†œç™Œ</option><option>åµå·¢ç™Œ</option><option>å­å®®é ¸ç™Œ</option>
        <option>å­å®®æƒ¡æ€§è‚‰ç˜¤</option><option>å¤–é™°ç™Œ</option><option>é™°é“ç™Œ</option>
        <option>å¦Šå¨ æ»‹é¤Šå±¤ç´°èƒè…«ç˜¤ (GTN)</option><option>è‡ªå‹•åˆ¤æ–·</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title">ğŸ“„ ä¸Šå‚³å ±å‘Šåœ–ç‰‡</div>
      <div class="upload-area" id="upload_area">
        <input type="file" id="ai_files" accept="image/png,image/jpg,image/jpeg" multiple onchange="previewImages(event)">
        <div class="upload-icon">ğŸ“</div>
        <p><strong>é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³åœ–ç‰‡</strong></p>
        <p style="margin-top:5px;font-size:0.76rem;">æ”¯æ´ JPG / PNGï¼Œå¯å¤šå¼µä¸Šå‚³</p>
      </div>
      <div class="preview-grid" id="ai_preview"></div>
    </div>
    <button class="btn" onclick="runAI()">ğŸ”¬ é–‹å§‹ AI åˆ†æ</button>
    <div class="spinner" id="ai_spinner">
      <div class="spin-circle"></div>
      AI æ­£åœ¨ä»”ç´°é–±è®€å ±å‘Šä¸¦é€²è¡Œåˆ†æœŸé‹ç®—...
    </div>
    <div class="ai-result-box" id="ai_result">
      <h2>ğŸ“‹ AI åˆ†æçµæœ <span style="font-weight:300;font-size:0.8em;color:var(--text-muted);">Gemini 2.5 Flash</span></h2>
      <div id="ai_result_body"></div>
    </div>
  </div>

</main>
</div>

<!-- MOBILE BOTTOM NAV -->
<nav class="bottom-nav">
  <div class="bottom-nav-scroll">
    <button class="active" onclick="showPage('endometrial',this)"><span class="nav-icon">ğŸ“‹</span>å…§è†œç™Œ</button>
    <button onclick="showPage('ovarian',this)"><span class="nav-icon">ğŸ”µ</span>åµå·¢ç™Œ</button>
    <button onclick="showPage('cervical',this)"><span class="nav-icon">ğŸ”´</span>å­å®®é ¸</button>
    <button onclick="showPage('sarcoma',this)"><span class="nav-icon">ğŸŸ </span>è‚‰ç˜¤</button>
    <button onclick="showPage('melanoma',this)"><span class="nav-icon">âš«</span>é»‘è‰²ç´ ç˜¤</button>
    <button onclick="showPage('vaginal',this)"><span class="nav-icon">ğŸŸ£</span>é™°é“ç™Œ</button>
    <button onclick="showPage('gtn',this)"><span class="nav-icon">ğŸŸ¡</span>GTN</button>
    <button onclick="showPage('vulvar',this)"><span class="nav-icon">ğŸŸ¤</span>å¤–é™°ç™Œ</button>
    <button onclick="showPage('ai',this)"><span class="nav-icon">ğŸ¤–</span>AI åˆ¤è®€</button>
  </div>
</nav>

<script>
// â”€â”€ NAVIGATION â”€â”€
function showPage(id, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('aside button, .bottom-nav-scroll button').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
  // activate matching buttons in both sidebar & bottom nav
  document.querySelectorAll(`aside button, .bottom-nav-scroll button`).forEach(b => {
    if (b.getAttribute('onclick') === `showPage('${id}',this)`) b.classList.add('active');
  });
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â”€â”€ HELPERS â”€â”€
function radioVal(name) { return document.querySelector(`input[name="${name}"]:checked`)?.value; }
function chk(id) { return !!document.getElementById(id)?.checked; }
function showResult(id, msg, tnm) {
  const el = document.getElementById(id);
  el.innerHTML = 'âœ… ' + msg;
  el.className = 'result-box result-success show';
  el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  const tnmId = id.replace('result', 'tnm').replace('_result', '_tnm');
  const tnmEl = document.getElementById(tnmId) || document.getElementById(id + '_tnm');
  if (tnmEl && tnm) { tnmEl.innerHTML = 'ğŸ“Š AJCC TNM: ' + tnm; tnmEl.className = 'result-box result-info show'; }
}
function showExtra(id, msg, cls) {
  const el = document.getElementById(id);
  el.innerHTML = msg; el.className = `result-box ${cls} show`;
}

// â”€â”€ ENDOMETRIAL â”€â”€
function stageEndometrial() {
  const histo = radioVal('ec_histo');
  const myo = radioVal('ec_myo');
  const lvsi = radioVal('ec_lvsi');
  const ln = radioVal('ec_ln');
  const ag = histo === 'aggressive';
  let T = myo === 'ge50' ? 'T1b' : 'T1a';
  if (chk('ec_cervical')) T = 'T2';
  if (chk('ec_serosa') || chk('ec_ovarian_tubal') || chk('ec_ovarian_limited')) T = 'T3a';
  if (chk('ec_vaginal') || chk('ec_pelvic_peri')) T = 'T3b';
  if (chk('ec_bladder')) T = 'T4';
  let N = 'N0';
  if (chk('ec_pelvic_ln')) N = ln === 'micro' ? 'N1mi' : 'N1a';
  if (chk('ec_pa_ln')) N = ln === 'micro' ? 'N2mi' : 'N2a';
  const M = chk('ec_distant') ? 'M1' : 'M0';
  let r = '';
  if (chk('ec_pole') && ['T1a','T1b','T2'].includes(T) && N==='N0' && M==='M0') r = 'Stage IAmPOLEmut';
  else if (chk('ec_p53') && ['T1a','T1b','T2'].includes(T) && N==='N0' && M==='M0') r = 'Stage IICmp53abn';
  else if (M==='M1') r = 'FIGO Stage 4C';
  else if (chk('ec_upper_abd')) r = 'FIGO Stage 4B';
  else if (T==='T4') r = 'FIGO Stage 4A';
  else if (N==='N2mi') r = 'FIGO Stage 3C2i';
  else if (N==='N2a') r = 'FIGO Stage 3C2ii';
  else if (N==='N1mi') r = 'FIGO Stage 3C1i';
  else if (N==='N1a') r = 'FIGO Stage 3C1ii';
  else if (chk('ec_serosa')) r = 'FIGO Stage 3A2';
  else if (chk('ec_ovarian_limited') && !ag && myo!=='ge50' && lvsi!=='extensive') r = 'FIGO Stage 1A3';
  else if (chk('ec_ovarian_tubal') || chk('ec_ovarian_limited')) r = 'FIGO Stage 3A1';
  else if (chk('ec_vaginal') && !chk('ec_pelvic_peri')) r = 'FIGO Stage 3B1';
  else if (chk('ec_pelvic_peri')) r = 'FIGO Stage 3B2';
  else if (ag && myo !== 'none') r = 'FIGO Stage 2C';
  else if (chk('ec_cervical') && !ag) r = 'FIGO Stage 2A';
  else if (lvsi==='extensive' && !ag) r = 'FIGO Stage 2B';
  else if (!ag) { r = myo==='ge50' ? 'FIGO Stage 1B' : myo==='lt50' ? 'FIGO Stage 1A2' : 'FIGO Stage 1A1'; }
  else if (ag && myo==='none') r = 'FIGO Stage 1C';
  else r = 'éœ€é€²ä¸€æ­¥è©•ä¼°';
  showResult('ec_result', r, `${T} ${N} ${M}`);
}

// â”€â”€ OVARIAN â”€â”€
function stageOvarian() {
  const T = document.getElementById('ov_t').value;
  const N = document.getElementById('ov_n').value;
  const M = document.getElementById('ov_m').value;
  const map = {M1a:'Stage IVA',M1b:'Stage IVB'};
  let s = map[M] || '';
  if (!s) {
    if (N==='N1a') s='Stage IIIA1i';
    else if (N==='N1b') s='Stage IIIA1ii';
    else { const tm = {T3a:'IIIA2',T3b:'IIIB',T3c:'IIIC',T2a:'IIA',T2b:'IIB',T1a:'IA',T1b:'IB',T1c1:'IC1',T1c2:'IC2',T1c3:'IC3'}; s='Stage '+(tm[T]||'?'); }
  }
  showResult('ov_result', s, `${T} ${N} ${M}`);
}

// â”€â”€ CERVICAL â”€â”€
function stageCervical() {
  const T = document.getElementById('cx_t').value;
  const N = document.getElementById('cx_n').value;
  const M = document.getElementById('cx_m').value;
  let f = '';
  if (T==='T4') f = M==='M0' ? 'Stage IVA' : 'Stage IVB';
  else if (M==='M1') f = 'Stage IVB';
  else if (N==='N1'||N==='N0i') f = 'Stage IIIC';
  else {
    const m = {T1a1:'IA1',T1a2:'IA2',T1b1:'IB1',T1b2:'IB2',T1b3:'IB3',T2a1:'IIA1',T2a2:'IIA2',T2b:'IIB',T3a:'IIIA',T3b:'IIIB',T3c1:'IIIC1',T3c2:'IIIC2'};
    f = 'Stage ' + (m[T]||'?');
  }
  showResult('cx_result', `FIGO: ${f}`, `${T} ${N} ${M}`);
}

// â”€â”€ SARCOMA â”€â”€
const SARC_T = {
  LMS:['T1a (â‰¤5 cm)','T1b (>5 cm)','T2a (adnexa)','T2b (pelvic tissues)','T3a (one abdominal site)','T3b (>one abdominal site)','T4 (bladder/rectum)'],
  ESS:['T1a (â‰¤5 cm)','T1b (>5 cm)','T2a (adnexa)','T2b (pelvic tissues)','T3a (one abdominal site)','T3b (>one abdominal site)','T4 (bladder/rectum)'],
  MAS:['T1a (endometrium/endocervix)','T1b (â‰¤half myometrium)','T1c (>half myometrium)','T2a (adnexa)','T2b (pelvic tissues)','T3a (one abdominal site)','T3b (>one abdominal site)','T4 (bladder/rectum)']
};
const SARC_ST = {
  LMS:{T1a:'IA',T1b:'IB',T2a:'IIA',T2b:'IIB',T3a:'IIIA',T3b:'IIIB',T4:'IVA'},
  ESS:{T1a:'IA',T1b:'IB',T2a:'IIA',T2b:'IIB',T3a:'IIIA',T3b:'IIIB',T4:'IVA'},
  MAS:{T1a:'IA',T1b:'IB',T1c:'IC',T2a:'IIA',T2b:'IIB',T3a:'IIIA',T3b:'IIIB',T4:'IVA'}
};
function updateSarcomaT() {
  const type = radioVal('sarc_type');
  const sel = document.getElementById('sarc_t');
  sel.innerHTML = SARC_T[type].map(o => `<option value="${o.split(' ')[0]}">${o}</option>`).join('');
}
updateSarcomaT();
function stageSarcoma() {
  const type = radioVal('sarc_type');
  const T = document.getElementById('sarc_t').value;
  const N = document.getElementById('sarc_n').value;
  const M = document.getElementById('sarc_m').value;
  let r = M==='M1' ? 'FIGO Stage IVB' : N==='N1' ? 'FIGO Stage IIIC' : 'FIGO Stage '+(SARC_ST[type][T]||'N/A');
  showResult('sarc_result', r, `${T} ${N} ${M}`);
}

// â”€â”€ MELANOMA â”€â”€
function stageMelanoma() {
  const T = document.getElementById('mel_t').value;
  const N = document.getElementById('mel_n').value;
  const M = document.getElementById('mel_m').value;
  let s = 'æœªåˆ†é¡';
  if (T==='Tis'&&N==='N0'&&M==='M0') s='Stage 0';
  else if (T==='T1a'&&N==='N0'&&M==='M0') s='Stage IA';
  else if ((T==='T1b'||T==='T2a')&&N==='N0'&&M==='M0') s='Stage IB';
  else if ((T==='T2b'||T==='T3a')&&N==='N0'&&M==='M0') s='Stage IIA';
  else if ((T==='T3b'||T==='T4a')&&N==='N0'&&M==='M0') s='Stage IIB';
  else if (T==='T4b'&&N==='N0'&&M==='M0') s='Stage IIC';
  else if (N!=='N0'&&M==='M0') s='Stage III';
  else if (M!=='M0') s='Stage IV';
  showResult('mel_result', `AJCC ${s}`, `${T} ${N} ${M}`);
}

// â”€â”€ VAGINAL â”€â”€
function stageVaginal() {
  const T = document.getElementById('vag_t').value;
  const N = document.getElementById('vag_n').value;
  const M = document.getElementById('vag_m').value;
  let r = M==='M1' ? 'FIGO Stage IVB' : T==='T4' ? 'FIGO Stage IVA'
    : (T==='T3'&&N==='N0') ? 'FIGO Stage III' : N==='N1' ? 'FIGO Stage III'
    : (T==='T2a'||T==='T2b') ? 'FIGO Stage II' : (T==='T1a'||T==='T1b') ? 'FIGO Stage I' : 'è³‡æ–™ä¸è¶³';
  showResult('vag_result', r, `${T} ${N} ${M}`);
}

// â”€â”€ GTN â”€â”€
function stageGTN() {
  const T = radioVal('gtn_t');
  const M = radioVal('gtn_m');
  let s = M==='M0' ? (T==='T1' ? 'FIGO Stage I' : 'FIGO Stage II') : M==='M1a' ? 'FIGO Stage III' : 'FIGO Stage IV';
  const ids = ['gtn_age','gtn_preg','gtn_interval','gtn_hcg','gtn_size','gtn_site','gtn_num','gtn_chemo'];
  const score = ids.reduce((acc,id) => acc + parseInt(document.getElementById(id).value), 0);
  const risk = score < 7 ? 'ä½é¢¨éšª (Low Risk)' : 'é«˜é¢¨éšª (High Risk)';
  showResult('gtn_result', s, null);
  showExtra('gtn_score', `âš ï¸ WHO é¢¨éšªåˆ†æ•¸ï¼š${score} â†’ ${risk}`, 'result-warning');
}

// â”€â”€ VULVAR â”€â”€
function stageVulvar() {
  const T = document.getElementById('vul_t').value;
  const N = document.getElementById('vul_n').value;
  const M = document.getElementById('vul_m').value;
  let f = '';
  if (M==='M1') f='Stage IVB';
  else if (T==='T3'||N==='N3') f='Stage IVA';
  else if (N==='N2c') f='Stage IIIC';
  else if (N==='N2a'||N==='N2b') f='Stage IIIB';
  else if (N==='N1a'||N==='N1b') f='Stage IIIA';
  else {
    const m = {'Tis,N0,M0':'Stage 0','T1a,N0,M0':'Stage IA','T1b,N0,M0':'Stage IB','T2,N0,M0':'Stage II'};
    f = m[`${T},${N},${M}`] || 'æœªçŸ¥åˆ†æœŸ';
  }
  showResult('vul_result', `FIGO ${f}`, `${T} ${N} ${M}`);
}

// â”€â”€ AI â”€â”€
let uploadedFiles = [];

function previewImages(e) {
  uploadedFiles = [...uploadedFiles, ...Array.from(e.target.files)];
  renderPreviews();
}
function renderPreviews() {
  const grid = document.getElementById('ai_preview');
  grid.innerHTML = '';
  uploadedFiles.forEach((f, i) => {
    const url = URL.createObjectURL(f);
    const div = document.createElement('div');
    div.className = 'preview-item';
    div.innerHTML = `<img src="${url}" alt="preview"><button class="rm-btn" onclick="removeFile(${i})">âœ•</button>`;
    grid.appendChild(div);
  });
}
function removeFile(i) { uploadedFiles.splice(i, 1); renderPreviews(); }

async function runAI() {
  const apiKey = document.getElementById('ai_apikey').value.trim();
  const context = document.getElementById('ai_context').value;
  if (!apiKey) { alert('è«‹å…ˆè¼¸å…¥ Gemini API Key'); return; }
  if (!uploadedFiles.length) { alert('è«‹è‡³å°‘ä¸Šå‚³ä¸€å¼µå ±å‘Šåœ–ç‰‡'); return; }
  document.getElementById('ai_spinner').className = 'spinner show';
  document.getElementById('ai_result').className = 'ai-result-box';
  try {
    const prompt = `ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„å©¦ç§‘è…«ç˜¤ç§‘é†«å¸«ã€‚ç›®å‰çš„ç™Œç—‡é¡å‹ä¸Šä¸‹æ–‡ç‚ºï¼š${context}ã€‚
è«‹åˆ†æåœ–ç‰‡ä¸­çš„ç—…ç†å ±å‘Šï¼ŒåŸ·è¡Œä»¥ä¸‹ä»»å‹™ï¼š
1. æ‘˜è¦é—œéµç™¼ç¾ï¼šæå–è…«ç˜¤å¤§å°ã€ä¾µçŠ¯æ·±åº¦ã€æ·‹å·´çµç‹€æ…‹ã€é ç«¯è½‰ç§»ã€çµ„ç¹”å­¸å‹æ…‹ç­‰é—œéµè³‡è¨Šã€‚
2. æ ¹æ“šæœ€æ–° FIGO èˆ‡ AJCC TNM ç³»çµ±åˆ¤å®šåˆ†æœŸï¼Œä¸¦è©³ç´°èªªæ˜åˆ¤å®šç†ç”±ã€‚
3. ä»¥ Markdown è¡¨æ ¼åˆ—å‡º Tã€Nã€M çš„åˆ¤å®šçµæœã€‚
è‹¥è³‡è¨Šä¸è¶³ï¼Œè«‹æŒ‡å‡ºç¼ºå°‘å“ªäº›é—œéµè³‡æ–™ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ã€‚`;
    const parts = [{ text: prompt }];
    for (const file of uploadedFiles) {
      const b64 = await toBase64(file);
      parts.push({ inline_data: { mime_type: file.type, data: b64 } });
    }
    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
      method: 'POST', headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ contents: [{ parts }] })
    });
    const data = await res.json();
    document.getElementById('ai_spinner').className = 'spinner';
    if (res.ok) {
      const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || 'ç„¡æ³•è§£æå›å‚³å…§å®¹';
      document.getElementById('ai_result_body').innerHTML = md2html(text);
      document.getElementById('ai_result').className = 'ai-result-box show';
      document.getElementById('ai_result').scrollIntoView({ behavior: 'smooth' });
    } else {
      alert(`API éŒ¯èª¤ (${res.status}): ${data?.error?.message || 'æœªçŸ¥éŒ¯èª¤'}`);
    }
  } catch (err) {
    document.getElementById('ai_spinner').className = 'spinner';
    alert('ç™¼ç”ŸéŒ¯èª¤ï¼š' + err.message);
  }
}

function toBase64(file) {
  return new Promise((res, rej) => {
    const r = new FileReader();
    r.onload = () => res(r.result.split(',')[1]);
    r.onerror = rej;
    r.readAsDataURL(file);
  });
}

function md2html(md) {
  return md
    .replace(/^#### (.+)$/gm, '<h4>$1</h4>')
    .replace(/^### (.+)$/gm, '<h3>$1</h3>')
    .replace(/^## (.+)$/gm, '<h2 style="margin-top:12px;">$1</h2>')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .replace(/^[-â€¢*] (.+)$/gm, '<li>$1</li>')
    .replace(/(<li>.*<\/li>\n?)+/gs, m => `<ul>${m}</ul>`)
    .replace(/^\|(.+)\|$/gm, row => {
      const cells = row.split('|').filter(c => c.trim() !== '');
      return '<tr>' + cells.map(c => c.trim().match(/^[-:]+$/) ? '' : `<td>${c.trim()}</td>`).join('') + '</tr>';
    })
    .replace(/(<tr>.*<\/tr>\n?)+/gs, rows => {
      const cleaned = rows.replace(/<tr><\/tr>\n?/g, '');
      return `<table>${cleaned}</table>`;
    })
    .replace(/\n\n/g, '<br><br>').replace(/\n/g, '<br>');
}
</script>
</body>
</html>
